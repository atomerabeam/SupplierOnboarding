sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","../model/models","sap/m/MessageToast"],function(e,t,o,l){"use strict";return e.extend("vbipsupplier.controller.SupplierInfo",{onInit:function(){this._onInit();let e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("SupplierInfo").attachPatternMatched(this._onObjectMatched,this)},onContinue:function(){this.getView().getModel("PageModel").setProperty("/pageFlow/infoRequest",false);let e=this.getView().byId("idAcceptCard.Select").getSelectedKey();if(e==="true"){this.getView().getModel("PageModel").setProperty("/pageFlow/complete",true)}else{this.getView().getModel("PageModel").setProperty("/pageFlow/infoConfirm",true)}},onConfirmInfo:function(){this.getView().getModel("PageModel").setProperty("/pageFlow/infoConfirm",false);this.getView().getModel("PageModel").setProperty("/pageFlow/corporate",true)},onContinueStep1:function(){this.getView().getModel("PageModel").setProperty("/pageFlow/corporate",false);this.getView().getModel("PageModel").setProperty("/pageFlow/shareholder",true)},onContinueStep2:function(){this.getView().getModel("PageModel").setProperty("/pageFlow/shareholder",false);this.getView().getModel("PageModel").setProperty("/pageFlow/complete",true);this._updateSupplier("noMessage")},onReportInfo:function(){},onSaveAndExit:async function(){this._updateSupplier("message");this.getView().getModel("PageModel").setProperty("/pageFlow/corporate",false);this.getView().getModel("PageModel").setProperty("/pageFlow/shareholder",false);this.getView().getModel("PageModel").setProperty("/pageFlow/infoRequest",true)},onChangeShareCount:function(){let e=new t;this.getView().setModel(e,"ShareholderModel");var o=this.getView().getModel("F4").getProperty("/shareholder/count");var l=[];for(var i=1;i<=o;i++){l.push({name:"",sharePercentage:"",Documents:[{documentName:"",documentType:"",nameonDocument:"",documentNumber:""}]})}this.getView().getModel("ShareholderModel").setProperty("/item",l)},onUploadFileButton:async function(e){let t=e.getParameter("id");let o=t.split("idUploadFile")[1].split(".Button")[0];let l=document.createElement("input");l.type="file";l.multiple=true;l.accept="image/*";let i;l.onchange=async function(){let e=l.files;i=e;for(let o=0;o<e.length;o++){let l=e[o];let i=await l.arrayBuffer();let s=await l.text();var t=new Uint8Array(i);var r=t.byteLength;var n="";for(let e=0;e<r;e++){n+=String.fromCharCode(t[e])}n=btoa(n)}let s=this.getView().getModel("FileModel");s.setProperty("/file"+o,{fileName:i[0].name,fileType:i[0].type,fileData:n,uploadVisible:false,fileVisible:true})}.bind(this);l.click()},onDeleteFileButton:async function(e){let t=e.getParameter("id");let o=t.split("idDeleteFile")[1].split(".Icon")[0];let l=this.getView().getModel("FileModel");l.setProperty("/file"+o,{fileName:null,fileType:null,fileData:null,uploadVisible:true,fileVisible:false});this.getView().setModel(l,"FileModel")},onDownloadFileButton:async function(e){let t=e.getParameter("id");let o=t.split("idDownloadFile")[1].split(".Icon")[0];let l=this.getView().getModel("FileModel");let i=l.getProperty("/file"+o);const r=document.createElement("a");let n=i.fileType;r.href="data:"+n+";base64,"+i.fileData;r.download=i.fileName;r.click()},onEnterShareholderPopup:function(){if(!this._oDialog){this._oDialog=new sap.ui.xmlfragment("vbipsupplier.view.fragment.ShareholderPopup",this);this.getView().addDependent(this._oDialog)}this._oDialog.open()},onDialogAfterClose:function(){this._oDialog.destroy();this._oDialog=null},onSave:function(){},onCancel:function(){this.onDialogAfterClose()},_onInit:async function(){let e=new t;let l={infoRequest:false,infoConfirm:false,corporate:false,shareholder:true,complete:false};e.setProperty("/pageFlow",l);this.getView().setModel(e,"PageModel");let i=new t;i.setProperty("/shareholder",{count:1});let r=await o.getBusinessNature();let n;if(r.response.value){n=r.response.value.businessNature.value}i.setProperty("/businessNature",n);this.getView().setModel(i,"F4");this.onChangeShareCount();let s=new t;for(let e=1;e<=2;e++){s.setProperty("/file"+e,{fileName:null,fileType:null,fileData:null,uploadVisible:true,fileVisible:false})}this.getView().setModel(s,"FileModel");let a=new t;let p,u;let d=this.getOwnerComponent().getModel("SupplierInfo").getProperty("/supplier");if(d!==undefined){if(d.SAPCustomer==="true"){p="true"}else if(d.SAPCustomer==="false"){p="false"}else if(d.SAPCustomer===null){p="true"}if(d.status===null||d.status==="Sent"){u="false"}else{u="true"}let e={SAPCustomer:p,acceptCard:u};a.setProperty("/requestInfo",e);this.getView().setModel(a,"RequestInfo");this.getView().getModel("PageModel").setProperty("/pageFlow/infoRequest",true)}else{let e=this.getOwnerComponent().getRouter()}},_onObjectMatched:function(e){this._onInit()},_updateSupplier:async function(e){let t=this.getOwnerComponent().getModel("SupplierInfo").getProperty("/supplier");delete t["@odata.context"];delete t["createdAt"];delete t["createdBy"];delete t["modifiedAt"];delete t["modifiedBy"];delete t["countryCode_code"];delete t["businessNature_selectKey"];let i=t.ID;delete t["ID"];let r={pID:i,oSupplier:t};let n=await o.updateSupplier(r);if(Object.keys(n.catchError).length===0&&n.catchError.constructor===Object){if(n.response.error){let e=`Operation failed Supplier ${t.supplierID} \nError code ${n.response.error.code}`}else{let o=`Supplier ${t.supplierID} information is update`;if(e==="message"){l.show(o)}}}else{let e=`Operation failed Supplier ${t.supplierID} \nError catched`}}})});