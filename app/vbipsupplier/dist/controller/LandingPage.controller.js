sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","../model/models","sap/m/MessageToast"],function(e,t,o,r){"use strict";return e.extend("vbipsupplier.controller.LandingPage",{onInit:function(){this._onInit()},onResendOTPLinkPress:async function(){let e=this.getOwnerComponent().getModel("SupplierInfo").getProperty("/supplier");let t=this.getOwnerComponent().getModel("SupplierInfo").getProperty("/VBIP");let n=e.emailID;let s={pID:this._GUID,smtpDestination:t.smtpDestination,mailTo:n,mailSubject:"VBIP Supplier OTP",mailContent:`<strong>Dear Supplier</strong><br/><br/>\n                                    <p>Your OTP code is [OTP]</p><br/><p>Thanks</p>`};let i=await o.sendMailOTP(s);if(i.response.ok===true){r.show("Sent OTP")}else{r.show("Failed to send OTP")}},onContinueButtonPress:async function(){let e=this.getView().byId("idOTP.Input").getValue();let t={pID:this._GUID,pOTP:e};let n=await o.checkOTP(t);if(Object.keys(n.catchError).length===0&&n.catchError.constructor===Object){if(n.response.error){let e=`Failed to process \nError code ${n.response.error.code}`;r.show(e)}else{let e=n.response.value;let t;if(e==="Invalid"){t="Invalid OTP";r.show(t)}else if(e==="Expired"){t="Your OTP is expired";r.show(t)}else if(e==="OK"){let e=this.getOwnerComponent().getRouter();e.navTo("SupplierInfo")}}}else{let e=`Failed to process \nError catched`;r.show(e)}},_onObjectMatched:function(e){this._GUID=e.getParameter("arguments").GUID},_onInit:async function(){let e=new t;let r={otp:false,landing:false};e.setProperty("/pageFlow",r);this.getView().setModel(e,"PageModel");let n=sap.ui.core.UIComponent.getRouterFor(this);n.getRoute("Supplier").attachPatternMatched(this._onObjectMatched,this);await o.getNothing();let s={pID:this._GUID};let i=await o.getSupplier(s);if(Object.keys(i.catchError).length===0&&i.catchError.constructor===Object){if(i.response.error){let e=`Failed to get Supplier information \nError code ${i.response.error.code}`;this.getView().getModel("PageModel").setProperty("/pageFlow/landing",true)}else{if(i.response.value.supplier.error){this.getView().getModel("PageModel").setProperty("/pageFlow/landing",true)}else{this.getOwnerComponent().getModel("SupplierInfo").setProperty("/supplier",i.response.value.supplier);await this._getBuyerInfo(i.response.value.supplier.buyerID);this.onResendOTPLinkPress();this.getView().getModel("PageModel").setProperty("/pageFlow/otp",true)}}}else{let e=`Failed to get Supplier information \nError catched`;this.getView().getModel("PageModel").setProperty("/pageFlow/landing",true)}},_getBuyerInfo:async function(e){let t={pID:e};let r=await o.getBuyer(t);if(r.response.value){this.getOwnerComponent().getModel("SupplierInfo").setProperty("/buyer",r.response.value.buyer)}let n=await o.getBuyerOnboarding(t);if(n.response.value){this.getOwnerComponent().getModel("SupplierInfo").setProperty("/buyerOnboarding",n.response.value.buyerOnboarding)}let s={pID:n.response.value.buyerOnboarding.value[0].vbipID};let i=await o.getVBIP(s);if(i.response.value){this.getOwnerComponent().getModel("SupplierInfo").setProperty("/VBIP",i.response.value.vbip)}}})});