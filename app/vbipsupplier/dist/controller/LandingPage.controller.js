sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","../model/models","sap/m/MessageToast"],function(e,t,o,r){"use strict";return e.extend("vbipsupplier.controller.LandingPage",{onInit:function(){this._onInit()},onResendOTPLinkPress:async function(){let e=this.getOwnerComponent().getModel("SupplierInfo").getProperty("/supplier");let t=this.getOwnerComponent().getModel("SupplierInfo").getProperty("/VBIP");let s=e.emailID;let n={pID:this._GUID,smtpDestination:t.smtpDestination,mailTo:s,mailSubject:"VBIP Supplier OTP",mailContent:`<strong>Dear Supplier</strong><br/><br/>\n                                    <p>Your OTP code is [OTP]</p><br/><p>Thanks</p>`};let i=await o.sendMailOTP(n);if(i.response.ok===true){r.show("Sent OTP")}else{r.show("Failed to send OTP")}},onContinueButtonPress:async function(){let e=this.getView().byId("idOTP.Input").getValue();let t={pID:this._GUID,pOTP:e};let s=await o.checkOTP(t);if(Object.keys(s.catchError).length===0&&s.catchError.constructor===Object){if(s.response.error){let e=`Failed to process \nError code ${s.response.error.code}`;r.show(e)}else{let e=s.response.value;let t;if(e==="Invalid"){t="Invalid OTP";r.show(t)}else if(e==="Expired"){t="Your OTP is expired";r.show(t)}else if(e==="OK"){let e=this.getOwnerComponent().getRouter();e.navTo("SupplierInfo")}}}else{let e=`Failed to process \nError catched`;r.show(e)}},_onObjectMatched:function(e){this._GUID=e.getParameter("arguments").GUID},_onInit:async function(){let e=new t;let r={otp:false,landing:false};e.setProperty("/pageFlow",r);this.getView().setModel(e,"PageModel");let s=sap.ui.core.UIComponent.getRouterFor(this);s.getRoute("Supplier").attachPatternMatched(this._onObjectMatched,this);await o.checkService();let n={pID:this._GUID};let i=await o.decryptID(n);let l={buyerID:i.response.value.split("_")[0],supplierID:i.response.value.split("_")[1]};let p=await o.getSupplier(l);if(p.response){if(p.response.error){let e=`Failed to get Supplier information \nError code ${p.response.error.code}`;this.getView().getModel("PageModel").setProperty("/pageFlow/landing",true)}else{if(p.response.supplier.error){this.getView().getModel("PageModel").setProperty("/pageFlow/landing",true)}else if(p.response.supplier){this.getOwnerComponent().getModel("SupplierInfo").setProperty("/supplier",p.response.supplier);await this._getBuyerInfo(p.response.supplier.buyerID);this.onResendOTPLinkPress();this.getView().getModel("PageModel").setProperty("/pageFlow/otp",true)}}}else{let e=`Failed to get Supplier information \nError catched`;this.getView().getModel("PageModel").setProperty("/pageFlow/landing",true)}},_getBuyerInfo:async function(e){let t={buyerID:e};let r=await o.getBuyer(t);if(r.response.value){this.getOwnerComponent().getModel("SupplierInfo").setProperty("/buyer",r.response.value.buyer)}let s=await o.getBuyerOnboarding(t);if(s.response.value.buyerOnboarding.value[0]){let e={pID:s.response.value.buyerOnboarding.value[0].vbipID};let t=await o.getVBIP(e);if(t.response.value){this.getOwnerComponent().getModel("SupplierInfo").setProperty("/VBIP",t.response.value.vbip)}}}})});